<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSXpertise - Assessment Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }

        .glass {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script>
        // DATA LAYER
        const DB_KEYS = {
            SSC: 'se_ssc', QP: 'se_qp', NOS: 'se_nos', PC: 'se_pc',
            BATCHES: 'se_batches', STUDENTS: 'se_students',
            QUESTION_PAPERS: 'se_question_papers',
            RESPONSES: 'se_responses', MANUAL_CAPTURES: 'se_manual_captures'
        };

        window.Utils = {
            generateId: () => 'id_' + Math.random().toString(36).substr(2, 9) + Date.now(),
            getSSC: () => JSON.parse(localStorage.getItem(DB_KEYS.SSC) || '[]'),
            saveSSC: (ssc) => { const list = window.Utils.getSSC(); list.push(ssc); localStorage.setItem(DB_KEYS.SSC, JSON.stringify(list)); },
            deleteSSC: (id) => { let list = window.Utils.getSSC().filter(s => s.id !== id); localStorage.setItem(DB_KEYS.SSC, JSON.stringify(list)); },
            getQPs: () => JSON.parse(localStorage.getItem(DB_KEYS.QP) || '[]'),
            getQPsBySSC: (sscId) => window.Utils.getQPs().filter(q => q.sscId === sscId),
            saveQP: (qp) => { const list = window.Utils.getQPs(); list.push(qp); localStorage.setItem(DB_KEYS.QP, JSON.stringify(list)); },
            getBatches: () => JSON.parse(localStorage.getItem(DB_KEYS.BATCHES) || '[]'),
            saveBatch: (batch) => { const list = window.Utils.getBatches(); list.push(batch); localStorage.setItem(DB_KEYS.BATCHES, JSON.stringify(list)); },
            updateBatches: (batches) => localStorage.setItem(DB_KEYS.BATCHES, JSON.stringify(batches)),
            deleteBatch: (id) => {
                let list = window.Utils.getBatches().filter(b => b.id !== id);
                localStorage.setItem(DB_KEYS.BATCHES, JSON.stringify(list));
                let students = window.Utils.getStudents().filter(s => s.batchId !== id);
                localStorage.setItem(DB_KEYS.STUDENTS, JSON.stringify(students));
            },
            getStudents: () => JSON.parse(localStorage.getItem(DB_KEYS.STUDENTS) || '[]'),
            getStudentsByBatch: (batchId) => window.Utils.getStudents().filter(s => s.batchId === batchId),
            saveStudent: (student) => { const list = window.Utils.getStudents(); list.push(student); localStorage.setItem(DB_KEYS.STUDENTS, JSON.stringify(list)); },
            authenticateStudent: (username, password) => window.Utils.getStudents().find(s => s.username === username && s.password === password),
            getQuestionPapers: () => JSON.parse(localStorage.getItem(DB_KEYS.QUESTION_PAPERS) || '[]'),
            saveQuestionPaper: (qp) => { const list = window.Utils.getQuestionPapers(); list.push(qp); localStorage.setItem(DB_KEYS.QUESTION_PAPERS, JSON.stringify(list)); },
            getResponses: () => JSON.parse(localStorage.getItem(DB_KEYS.RESPONSES) || '[]'),
            saveResponse: (response) => {
                const list = window.Utils.getResponses();
                const existing = list.findIndex(r => r.studentId === response.studentId && r.examType === response.examType);
                if (existing >= 0) list[existing] = { ...list[existing], ...response };
                else list.push(response);
                localStorage.setItem(DB_KEYS.RESPONSES, JSON.stringify(list));
            },
            authenticateAssessor: (username, password) => window.Utils.getBatches().find(b => b.assessorUsername === username && b.assessorPassword === password)
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        const Icons = {
            User: () => <i data-lucide="user" className="w-5 h-5"></i>,
            Users: () => <i data-lucide="users" className="w-5 h-5"></i>,
            LogOut: () => <i data-lucide="log-out" className="w-5 h-5"></i>,
            Camera: () => <i data-lucide="camera" className="w-5 h-5"></i>,
            Plus: () => <i data-lucide="plus" className="w-5 h-5"></i>,
            Trash2: () => <i data-lucide="trash-2" className="w-4 h-4"></i>,
            Eye: () => <i data-lucide="eye" className="w-5 h-5"></i>,
            Upload: () => <i data-lucide="upload" className="w-5 h-5"></i>,
            Download: () => <i data-lucide="download" className="w-5 h-5"></i>,
            FileText: () => <i data-lucide="file-text" className="w-5 h-5"></i>,
            Book: () => <i data-lucide="book" className="w-5 h-5"></i>,
            Cpu: () => <i data-lucide="cpu" className="w-5 h-5"></i>,
            Edit3: () => <i data-lucide="edit-3" className="w-4 h-4"></i>,
            UserPlus: () => <i data-lucide="user-plus" className="w-5 h-5"></i>,
        };

        // LOGIN
        const LoginScreen = ({ onLogin }) => {
            const [role, setRole] = useState('admin');
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                setError('');
                if (role === 'admin' && username === 'admin' && password === 'admin') {
                    onLogin({ role: 'admin', name: 'Administrator' });
                } else if (role === 'student') {
                    const student = window.Utils.authenticateStudent(username, password);
                    if (student) onLogin({ role: 'student', ...student });
                    else setError('Invalid student credentials');
                } else if (role === 'assessor') {
                    const batch = window.Utils.authenticateAssessor(username, password);
                    if (batch) onLogin({ role: 'assessor', name: 'Assessor', batchId: batch.id });
                    else setError('Invalid assessor credentials');
                } else setError('Invalid credentials');
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-500 to-purple-600 p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md glass">
                        <h1 className="text-3xl font-bold text-center text-gray-800 mb-2">NSXpertise</h1>
                        <p className="text-center text-gray-500 mb-8">Assessment Management System</p>
                        <div className="flex justify-center gap-4 mb-6">
                            {['admin', 'student', 'assessor'].map(r => (
                                <button key={r} onClick={() => setRole(r)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${role === r ? 'bg-indigo-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>
                                    {r.charAt(0).toUpperCase() + r.slice(1)}
                                </button>
                            ))}
                        </div>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                <input type="text" required className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                    value={username} onChange={e => setUsername(e.target.value)} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input type="password" required className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                    value={password} onChange={e => setPassword(e.target.value)} />
                            </div>
                            {error && <p className="text-red-500 text-sm text-center bg-red-50 p-2 rounded">{error}</p>}
                            <button type="submit" className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transform hover:scale-[1.02] transition-all">
                                Login as {role.charAt(0).toUpperCase() + role.slice(1)}
                            </button>
                            <div className="text-center text-xs text-gray-400 mt-4"><p>Demo: admin/admin</p></div>
                        </form>
                    </div>
                </div>
            );
        };

        // ADMIN DASHBOARD
        const AdminDashboard = () => {
            const [activeTab, setActiveTab] = useState('subjects');
            return (
                <div className="p-8">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Admin Dashboard</h2>
                    <div className="flex gap-2 mb-6 overflow-x-auto">
                        {['subjects', 'questionPapers', 'batches', 'results'].map(tab => (
                            <button key={tab} onClick={() => setActiveTab(tab)}
                                className={`px-6 py-3 rounded-lg font-medium whitespace-nowrap transition-all ${activeTab === tab ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white text-gray-600 hover:bg-gray-50 border border-gray-200'
                                    }`}>
                                {tab.charAt(0).toUpperCase() + tab.slice(1).replace(/([A-Z])/g, ' $1')}
                            </button>
                        ))}
                    </div>
                    {activeTab === 'subjects' && <SubjectsTab />}
                    {activeTab === 'questionPapers' && <QuestionPapersTab />}
                    {activeTab === 'batches' && <BatchesTab />}
                    {activeTab === 'results' && <ResultsTab />}
                </div>
            );
        };

        // SUBJECTS TAB
        const SubjectsTab = () => {
            const [sscList, setSSCList] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [newSSC, setNewSSC] = useState({ name: '', code: '' });

            useEffect(() => setSSCList(window.Utils.getSSC()), []);

            const handleCreate = (e) => {
                e.preventDefault();
                const ssc = { ...newSSC, id: window.Utils.generateId(), createdAt: new Date().toISOString() };
                window.Utils.saveSSC(ssc);
                setSSCList(window.Utils.getSSC());
                setShowModal(false);
                setNewSSC({ name: '', code: '' });
            };

            return (
                <div>
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-xl font-bold">Sector Skill Councils (SSC)</h3>
                        <button onClick={() => setShowModal(true)} className="bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-indigo-700">
                            <Icons.Plus /> Add SSC
                        </button>
                    </div>
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50 border-b">
                                <tr>
                                    <th className="p-4 text-left font-bold text-gray-600">#</th>
                                    <th className="p-4 text-left font-bold text-gray-600">Name</th>
                                    <th className="p-4 text-left font-bold text-gray-600">Code</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                {sscList.map((ssc, idx) => (
                                    <tr key={ssc.id} className="hover:bg-gray-50">
                                        <td className="p-4">{idx + 1}</td>
                                        <td className="p-4 font-medium">{ssc.name}</td>
                                        <td className="p-4">{ssc.code}</td>
                                        <td className="p-4 text-center">
                                            <button onClick={() => { if (confirm('Delete?')) { window.Utils.deleteSSC(ssc.id); setSSCList(window.Utils.getSSC()); } }}
                                                className="text-red-600 hover:text-red-800"><Icons.Trash2 /></button>
                                        </td>
                                    </tr>
                                ))}
                                {sscList.length === 0 && <tr><td colSpan="4" className="p-8 text-center text-gray-400">No SSCs found</td></tr>}
                            </tbody>
                        </table>
                    </div>
                    {showModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-xl font-bold mb-4">Add New SSC</h3>
                                <form onSubmit={handleCreate} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Name</label>
                                        <input type="text" required className="w-full px-4 py-2 border rounded-lg"
                                            value={newSSC.name} onChange={e => setNewSSC({ ...newSSC, name: e.target.value })} />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Code</label>
                                        <input type="text" required className="w-full px-4 py-2 border rounded-lg"
                                            value={newSSC.code} onChange={e => setNewSSC({ ...newSSC, code: e.target.value })} />
                                    </div>
                                    <div className="flex gap-2 justify-end">
                                        <button type="button" onClick={() => setShowModal(false)} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                                        <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Create</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // QUESTION PAPERS TAB
        const QuestionPapersTab = () => {
            const [qpList, setQPList] = useState([]);
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [qpName, setQPName] = useState('');
            const [selectedQP, setSelectedQP] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => setQPList(window.Utils.getQuestionPapers()), []);

            const handleExcelUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const data = new Uint8Array(evt.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const rows = XLSX.utils.sheet_to_json(sheet);

                    const questions = rows.map((row, idx) => {
                        const questionType = (row.QuestionTypeID || '').toString().toUpperCase();
                        const isCoding = questionType === 'CODING';
                        const noOfOptions = isCoding ? 0 : parseInt(row.Noofoptions || 4);

                        return {
                            id: window.Utils.generateId(),
                            question: row.Question || row.question || '',
                            questionType: questionType || 'MCQ',
                            options: isCoding ? [] : [row.Option1, row.Option2, row.Option3, row.Option4, row.Option5].filter((o, i) => i < noOfOptions && o),
                            correctAnswer: row.Solution || row.Answer || '',
                            totalMarks: parseFloat(row.Marks || 1)
                        };
                    });

                    const qp = {
                        id: window.Utils.generateId(),
                        qpName: qpName || 'Question Paper',
                        questions: questions,
                        totalMarks: questions.reduce((sum, q) => sum + q.totalMarks, 0),
                        totalTime: 60,
                        createdAt: new Date().toISOString()
                    };

                    window.Utils.saveQuestionPaper(qp);
                    setQPList(window.Utils.getQuestionPapers());
                    setShowUploadModal(false);
                    setQPName('');
                    alert('Question Paper uploaded successfully!');
                };
                reader.readAsArrayBuffer(file);
            };

            return (
                <div>
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-xl font-bold">Question Papers</h3>
                        <button onClick={() => setShowUploadModal(true)} className="bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-indigo-700">
                            <Icons.Upload /> Upload Question Paper
                        </button>
                    </div>
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50 border-b">
                                <tr>
                                    <th className="p-4 text-left font-bold text-gray-600">#</th>
                                    <th className="p-4 text-left font-bold text-gray-600">Name</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Questions</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Total Marks</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                {qpList.map((qp, idx) => (
                                    <tr key={qp.id} className="hover:bg-gray-50">
                                        <td className="p-4">{idx + 1}</td>
                                        <td className="p-4 font-medium">{qp.qpName}</td>
                                        <td className="p-4 text-center">{qp.questions.length}</td>
                                        <td className="p-4 text-center font-bold">{qp.totalMarks}</td>
                                        <td className="p-4 text-center">
                                            <button onClick={() => setSelectedQP(qp)} className="text-indigo-600 hover:text-indigo-800"><Icons.Eye /></button>
                                        </td>
                                    </tr>
                                ))}
                                {qpList.length === 0 && <tr><td colSpan="5" className="p-8 text-center text-gray-400">No question papers found</td></tr>}
                            </tbody>
                        </table>
                    </div>

                    {showUploadModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-xl font-bold mb-4">Upload Question Paper</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Paper Name</label>
                                        <input type="text" required className="w-full px-4 py-2 border rounded-lg"
                                            value={qpName} onChange={e => setQPName(e.target.value)} placeholder="e.g., Theory Paper 1" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Excel File</label>
                                        <input ref={fileInputRef} type="file" accept=".xlsx,.xls" onChange={handleExcelUpload} className="w-full px-4 py-2 border rounded-lg" />
                                        <p className="text-xs text-gray-500 mt-2">
                                            Columns: Question, Option1-5, Solution, Noofoptions, QuestionTypeID<br />
                                            <span className="font-bold text-indigo-600">Tip: For Practical Papers, set QuestionTypeID to 'CODING'</span>
                                        </p>
                                    </div>
                                    <div className="flex gap-2 justify-end">
                                        <button type="button" onClick={() => setShowUploadModal(false)} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {selectedQP && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className="bg-white rounded-xl p-6 w-full max-w-2xl my-8">
                                <h3 className="text-xl font-bold mb-4">{selectedQP.qpName}</h3>
                                <div className="space-y-4 max-h-96 overflow-y-auto">
                                    {selectedQP.questions.map((q, idx) => (
                                        <div key={q.id} className="border-b pb-3">
                                            <p className="font-medium">Q{idx + 1}. {q.question} ({q.totalMarks} marks)</p>
                                            <p className="text-xs text-gray-500">Type: {q.questionType}</p>
                                            {q.questionType === 'CODING' ? (
                                                <p className="text-sm text-indigo-600 mt-1">Coding Question - Text Answer Required</p>
                                            ) : (
                                                <div className="mt-2 space-y-1">
                                                    {q.options.map((opt, i) => (
                                                        <p key={i} className={`text-sm ${opt === q.correctAnswer ? 'text-green-600 font-bold' : 'text-gray-600'}`}>
                                                            {String.fromCharCode(65 + i)}. {opt}
                                                        </p>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => setSelectedQP(null)} className="mt-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Close</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // BATCHES TAB
        const BatchesTab = () => {
            const [batches, setBatches] = useState([]);
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [showAssignModal, setShowAssignModal] = useState(false);
            const [selectedBatch, setSelectedBatch] = useState(null);
            const [assignmentType, setAssignmentType] = useState('Theory');
            const [selectedQP, setSelectedQP] = useState('');
            const [newBatch, setNewBatch] = useState({ name: '', startDate: '', endDate: '' });

            useEffect(() => setBatches(window.Utils.getBatches()), []);

            const handleCreateBatch = (e) => {
                e.preventDefault();
                const batch = {
                    ...newBatch,
                    id: window.Utils.generateId(),
                    assessorUsername: 'assessor_' + Math.random().toString(36).substr(2, 5),
                    assessorPassword: Math.random().toString(36).substr(2, 6),
                    createdAt: new Date().toISOString()
                };
                window.Utils.saveBatch(batch);
                setBatches(window.Utils.getBatches());
                setShowCreateModal(false);
                setNewBatch({ name: '', startDate: '', endDate: '' });
            };

            const handleAssignQP = () => {
                if (!selectedBatch || !selectedQP) return;
                const updatedBatches = batches.map(b => {
                    if (b.id === selectedBatch.id) {
                        return { ...b, [assignmentType === 'Practical' ? 'practicalPaperId' : 'theoryPaperId']: selectedQP };
                    }
                    return b;
                });
                window.Utils.updateBatches(updatedBatches);
                setBatches(updatedBatches);
                setShowAssignModal(false);
                setSelectedBatch(null);
                setSelectedQP('');
            };

            const questionPapers = window.Utils.getQuestionPapers();

            return (
                <div>
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-xl font-bold">Batches</h3>
                        <button onClick={() => setShowCreateModal(true)} className="bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-indigo-700">
                            <Icons.Plus /> Create Batch
                        </button>
                    </div>
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50 border-b">
                                <tr>
                                    <th className="p-4 text-left font-bold text-gray-600">#</th>
                                    <th className="p-4 text-left font-bold text-gray-600">Batch Name</th>
                                    <th className="p-4 text-left font-bold text-gray-600">Dates</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Assigned Exams</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Assessor</th>
                                    <th className="p-4 text-center font-bold text-gray-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                {batches.map((batch, idx) => (
                                    <tr key={batch.id} className="hover:bg-gray-50">
                                        <td className="p-4">{idx + 1}</td>
                                        <td className="p-4 font-medium">{batch.name}</td>
                                        <td className="p-4 text-sm text-gray-600">{batch.startDate} to {batch.endDate}</td>
                                        <td className="p-4">
                                            <div className="flex flex-col items-center gap-1">
                                                <button onClick={() => { setSelectedBatch(batch); setAssignmentType('Theory'); setShowAssignModal(true); }}
                                                    className="bg-indigo-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-indigo-700 w-full">
                                                    Assign QP
                                                </button>
                                                <div className="flex gap-2 text-xs font-mono">
                                                    <span className={`px-1 rounded ${batch.theoryPaperId ? 'bg-blue-100 text-blue-700 font-bold border border-blue-200' : 'bg-gray-100 text-gray-400 border border-gray-200'}`}>
                                                        T: {batch.theoryPaperId ? '✓' : '-'}
                                                    </span>
                                                    <span className={`px-1 rounded ${batch.practicalPaperId ? 'bg-purple-100 text-purple-700 font-bold border border-purple-200' : 'bg-gray-100 text-gray-400 border border-gray-200'}`}>
                                                        P: {batch.practicalPaperId ? '✓' : '-'}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                        <td className="p-4 text-center text-xs font-mono">
                                            {batch.assessorUsername && <div>{batch.assessorUsername} / {batch.assessorPassword}</div>}
                                        </td>
                                        <td className="p-4 text-center">
                                            <button onClick={() => { if (confirm('Delete?')) { window.Utils.deleteBatch(batch.id); setBatches(window.Utils.getBatches()); } }}
                                                className="text-red-600 hover:text-red-800"><Icons.Trash2 /></button>
                                        </td>
                                    </tr>
                                ))}
                                {batches.length === 0 && <tr><td colSpan="6" className="p-8 text-center text-gray-400">No batches found</td></tr>}
                            </tbody>
                        </table>
                    </div>

                    {showCreateModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-xl font-bold mb-4">Create New Batch</h3>
                                <form onSubmit={handleCreateBatch} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Batch Name</label>
                                        <input type="text" required className="w-full px-4 py-2 border rounded-lg"
                                            value={newBatch.name} onChange={e => setNewBatch({ ...newBatch, name: e.target.value })} />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Start Date</label>
                                        <input type="date" required className="w-full px-4 py-2 border rounded-lg"
                                            value={newBatch.startDate} onChange={e => setNewBatch({ ...newBatch, startDate: e.target.value })} />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">End Date</label>
                                        <input type="date" required className="w-full px-4 py-2 border rounded-lg"
                                            value={newBatch.endDate} onChange={e => setNewBatch({ ...newBatch, endDate: e.target.value })} />
                                    </div>
                                    <div className="flex gap-2 justify-end">
                                        <button type="button" onClick={() => setShowCreateModal(false)} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                                        <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Create</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {showAssignModal && selectedBatch && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-xl font-bold mb-4">Assign Question Paper</h3>
                                <div className="space-y-4">
                                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                        <p className="font-bold text-blue-900 mb-1">Batch: {selectedBatch.name}</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">Assignment Type</label>
                                        <div className="flex gap-4">
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input type="radio" name="assignType" value="Theory" checked={assignmentType === 'Theory'}
                                                    onChange={e => setAssignmentType(e.target.value)} className="accent-indigo-600" />
                                                <span>Theory Exam</span>
                                            </label>
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input type="radio" name="assignType" value="Practical" checked={assignmentType === 'Practical'}
                                                    onChange={e => setAssignmentType(e.target.value)} className="accent-indigo-600" />
                                                <span>Practical Exam (Coding)</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">Select Question Paper</label>
                                        <select className="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500"
                                            value={selectedQP} onChange={e => setSelectedQP(e.target.value)}>
                                            <option value="">-- Select Question Paper --</option>
                                            {questionPapers.map(qp => (
                                                <option key={qp.id} value={qp.id}>{qp.qpName} (Marks: {qp.totalMarks})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-2 justify-end">
                                        <button type="button" onClick={() => setShowAssignModal(false)} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                                        <button onClick={handleAssignQP} disabled={!selectedQP} className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                            Save Assignment
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // RESULTS TAB - Placeholder
        const ResultsTab = () => {
            return (
                <div className="bg-white rounded-xl shadow-sm border p-8 text-center">
                    <h3 className="text-xl font-bold mb-2">Results</h3>
                    <p className="text-gray-500">View student results (Coming in next chunk)</p>
                </div>
            );
        };

        // STUDENT PORTAL - Placeholder
        const StudentPortal = ({ user }) => {
            return (
                <div className="p-8">
                    <h2 className="text-2xl font-bold mb-4">Student Portal</h2>
                    <div className="bg-white rounded-xl shadow-sm border p-8 text-center">
                        <p className="text-gray-500">Welcome, {user.name}</p>
                        <p className="text-sm text-gray-400 mt-2">Exam interface coming in next chunk</p>
                    </div>
                </div>
            );
        };

        // ASSESSOR PORTAL - Placeholder
        const AssessorPortal = ({ user }) => {
            return (
                <div className="p-8">
                    <h2 className="text-2xl font-bold mb-4">Assessor Portal</h2>
                    <div className="bg-white rounded-xl shadow-sm border p-8 text-center">
                        <p className="text-gray-500">Welcome, Assessor</p>
                        <p className="text-sm text-gray-400 mt-2">Evidence capture coming in next chunk</p>
                    </div>
                </div>
            );
        };

        // MAIN APP
        const App = () => {
            const [user, setUser] = useState(null);
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });

            if (!user) return <LoginScreen onLogin={setUser} />;

            return (
                <div className="min-h-screen bg-slate-50">
                    <header className="bg-white shadow-sm border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">N</div>
                                <span className="font-bold text-gray-800 text-lg">NSXpertise</span>
                                <span className="ml-2 px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full font-medium uppercase">{user.role}</span>
                            </div>
                            <button onClick={() => setUser(null)} className="text-gray-500 hover:text-red-600 text-sm font-medium">Logout</button>
                        </div>
                    </header>
                    <main className="max-w-7xl mx-auto py-6 px-4">
                        {user.role === 'admin' && <AdminDashboard />}
                        {user.role === 'student' && <StudentPortal user={user} />}
                        {user.role === 'assessor' && <AssessorPortal user={user} />}
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>